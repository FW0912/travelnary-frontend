<div class="flex flex-col" [formGroup]="formGroup">
	<div class="flex gap-2">
		<div class="flex flex-col items-center">
			<div class="w-10 h-10 rounded-full bg-placeholder shrink-0"></div>

			@if(comment().replies.length > 0 || isReplyOpen()) {
			<div class="w-[1px] h-full border-l-2 border-gray-300"></div>
			}
		</div>

		<div class="flex flex-col gap-2 w-full">
			<div class="flex flex-col">
				<span class="font-medium text-sm">{{
					comment().owner.username
				}}</span>

				<span class="text-xs text-placeholder">{{
					comment().createdDate | timeAgo
				}}</span>
			</div>

			@if(!isEditOpen()) {
			<div class="text-sm">{{ comment().content }}</div>
			} @else {
			<div class="flex w-full gap-4">
				<app-text-area
					id="comment"
					name="comment"
					[minRows]="1"
					[maxRows]="3"
					placeholder="What's on your mind?"
					class="w-full"
					extraClasses="!min-h-10"
					formControlName="content"
				></app-text-area>

				<button
					class="text-sm font-medium text-primary cursor-pointer hover:text-primary-hover transition-colors"
					[ngClass]="{
						'!cursor-default !text-primary opacity-50':
							content.value.length === 0
					}"
				>
					Edit
				</button>
			</div>
			}

			<div class="flex gap-4 items-center">
				@if(isEditOpen()) {
				<div
					class="flex gap-1 items-center text-error hover:opacity-70 transition-opacity cursor-pointer"
					(click)="cancelEdit()"
				>
					<i class="bi bi-x-circle"></i>

					<span class="text-sm font-medium">Cancel Edit</span>
				</div>
				} @else if(isReplyOpen()) {
				<div
					class="flex gap-1 items-center text-error hover:opacity-70 transition-opacity cursor-pointer"
					(click)="cancelReply()"
				>
					<i class="bi bi-x-circle"></i>

					<span class="text-sm font-medium">Cancel Reply</span>
				</div>
				} @else {
				<div
					class="flex gap-2 items-center hover:opacity-70 transition-opacity cursor-pointer"
					(click)="onLike()"
				>
					<i
						class="bi text-lg text-error"
						style="-webkit-text-stroke: 0.5px"
						[ngClass]="
							comment().isLiked ? 'bi-heart-fill' : 'bi-heart'
						"
					></i>

					<span class="text-sm font-medium">{{
						comment().likeCount
					}}</span>
				</div>

				@if(comment().isOwner) {
				<div
					class="flex gap-1 items-center text-error hover:opacity-70 transition-opacity cursor-pointer"
					(click)="openDeletePopup()"
				>
					<i class="bi bi-trash3"></i>

					<span class="text-sm font-medium">Delete</span>
				</div>

				<div
					class="flex gap-1 items-center hover:opacity-70 transition-opacity cursor-pointer"
					(click)="onEdit()"
				>
					<i class="bi bi-pencil-square"></i>

					<span class="text-sm font-medium">Edit</span>
				</div>
				}

				<div
					class="flex gap-1 items-center hover:opacity-70 transition-opacity cursor-pointer"
					(click)="onReply()"
				>
					<i class="bi bi-reply"></i>

					<span class="text-sm font-medium">Reply</span>
				</div>
				}
			</div>
		</div>
	</div>

	@if(!isReplyOpen()) { @for(reply of comment().replies; let isLast = $last;
	track reply.id) {
	<div class="flex">
		<div class="flex flex-col w-10 shrink-0">
			<div
				class="w-[1px] h-7 border-l-2 border-gray-300 self-center"
			></div>

			<div
				class="h-[1px] w-1/2 border-t-2 border-gray-300 self-end"
			></div>

			@if(!isLast) {
			<div
				class="w-[1px] h-full border-l-2 border-gray-300 self-center"
			></div>
			}
		</div>

		<app-comment-details
			class="py-2 w-full"
			[comment]="reply"
		></app-comment-details>
	</div>
	} } @else {
	<div class="flex">
		<div class="flex flex-col w-10 shrink-0">
			<div
				class="w-[1px] h-7 border-l-2 border-gray-300 self-center"
			></div>

			<div
				class="h-[1px] w-1/2 border-t-2 border-gray-300 self-end"
			></div>
		</div>

		<div class="flex w-full py-2 gap-2">
			<div class="w-10 h-10 rounded-full bg-placeholder"></div>

			<div class="flex w-full gap-4">
				<app-text-area
					id="comment"
					name="comment"
					[minRows]="1"
					[maxRows]="3"
					placeholder="What's on your mind?"
					class="w-full"
					extraClasses="!min-h-10"
					formControlName="reply"
				></app-text-area>

				<button
					class="text-sm font-medium text-primary cursor-pointer hover:text-primary-hover transition-colors"
					[ngClass]="{
						'!cursor-default !text-primary opacity-50':
							reply.value.length === 0
					}"
				>
					Reply
				</button>
			</div>
		</div>
	</div>
	}
</div>
